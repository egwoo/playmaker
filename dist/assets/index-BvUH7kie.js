(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))a(d);new MutationObserver(d=>{for(const c of d)if(c.type==="childList")for(const y of c.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&a(y)}).observe(document,{childList:!0,subtree:!0});function s(d){const c={};return d.integrity&&(c.integrity=d.integrity),d.referrerPolicy&&(c.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?c.credentials="include":d.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function a(d){if(d.ep)return;d.ep=!0;const c=s(d);fetch(d.href,c)}})();const yt=["offense","defense"],se=60,re=30;function Xe(){return{players:[]}}function Ye(t){return t.players.reduce((o,s)=>{const a=Et(s);return a>o?a:o},0)}function ye(t,o){const s=t.route??[];if(s.length===0)return{...t.start};let a=Math.max(o,0),d=t.start;for(const c of s){const y=Me(d,c);if(y===0){d=c.to;continue}if(a<=y){const f=a/y;return{x:Ue(d.x,c.to.x,f),y:Ue(d.y,c.to.y,f)}}a-=y,d=c.to}return{...d}}function Te(t){return JSON.stringify(t)}function Ge(t){try{const o=JSON.parse(t);if(!me(o)||!Array.isArray(o.players))return null;const s=[];for(const a of o.players){const d=bt(a);if(!d)return null;s.push(d)}return{players:s}}catch{return null}}function Ue(t,o,s){return t+(o-t)*s}function me(t){return typeof t=="object"&&t!==null}function oe(t){return typeof t=="number"&&Number.isFinite(t)}function Je(t){return me(t)?oe(t.x)&&oe(t.y):!1}function mt(t){return yt.includes(t)}function gt(t){return!me(t)||!Je(t.to)||!oe(t.speed)||t.speed<=0?!1:"action"in t&&t.action!==void 0?je(t.action):!0}function ht(t){return Array.isArray(t)&&t.every(gt)}function bt(t){if(!me(t))return null;const{id:o,label:s,team:a,start:d}=t;if(typeof o!="string"||typeof s!="string"||!mt(a)||!Je(d))return null;let c;if("route"in t&&t.route!==void 0){if(!ht(t.route))return null;c=t.route}let y;if("startAction"in t&&t.startAction!==void 0){if(!je(t.startAction))return null;y=t.startAction}let f;if("assignment"in t&&t.assignment!==void 0){if(!vt(t.assignment))return null;f=t.assignment}return{id:o,label:s,team:a,start:d,route:c,startAction:y,assignment:f}}function Et(t){const o=t.route??[];let s=0,a=t.start;for(const d of o)s+=Me(a,d),a=d.to;return s}function Me(t,o){if(o.speed<=0)return 0;const s=It(t,o.to);return s===0?0:s/o.speed}function It(t,o){const s=(o.x-t.x)*re,a=(o.y-t.y)*se;return Math.hypot(s,a)}function je(t){if(!me(t))return!1;const{type:o,targetId:s}=t;return o!=="pass"&&o!=="handoff"?!1:typeof s=="string"}function vt(t){if(!me(t))return!1;const{type:o}=t;return o==="man"?St(t):o==="zone"?xt(t):!1}function St(t){return typeof t.targetId=="string"&&oe(t.speed)&&t.speed>0}function xt(t){return oe(t.radiusX)&&t.radiusX>0&&oe(t.radiusY)&&t.radiusY>0&&oe(t.speed)&&t.speed>0}const Pt=18,pe=1e-6;function Tt(t,o,s){const a=t.players.find(f=>f.team==="offense")??null;if(!a)return{position:null,carrierId:null,inAir:!1};const d=wt(t);let c=a,y=0;for(const f of d){if(f.time>o)break;if(f.time<y||c.id!==f.passerId||f.targetId===c.id)continue;const I=t.players.find(w=>w.id===f.targetId);if(!I)continue;const x=ye(c,f.time),g=At(x,f.time,I,s);if(g){if(g.time<=f.time+pe){c=I,y=g.time;continue}if(o<g.time){const w=g.time-f.time,v=Dt((o-f.time)/w,0,1);return{position:{x:Ze(x.x,g.point.x,v),y:Ze(x.y,g.point.y,v)},carrierId:c.id,inAir:!0,flight:{start:x,end:g.point,progress:v}}}c=I,y=g.time}}return{position:ye(c,o),carrierId:c.id,inAir:!1}}function wt(t){const o=[];let s=0;for(const a of t.players){const d=a.route??[];a.startAction&&o.push({time:0,passerId:a.id,targetId:a.startAction.targetId,type:a.startAction.type,order:s++});let c=0,y=a.start;for(const f of d){const I=Me(y,f);c+=I,y=f.to,f.action&&o.push({time:c,passerId:a.id,targetId:f.action.targetId,type:f.action.type,order:s++})}}return o.sort((a,d)=>a.time!==d.time?a.time-d.time:a.order-d.order)}function At(t,o,s,a){const d=Mt(s);let c=null;for(const y of d){const f=Lt(t,o,a,y);f!==null&&(c===null||f<c)&&(c=f)}return c===null?null:{time:c,point:ye(s,c)}}function Mt(t){const o=[],s=t.route??[];let a=0,d=t.start;for(const c of s){const y=Me(d,c),f=c.to,I=we(d),x=we(f),g=y>0?Ct(Qe(x,I),1/y):{x:0,y:0};o.push({startTime:a,endTime:a+y,start:d,end:f,velocityYards:g}),a+=y,d=f}return o.push({startTime:a,endTime:Number.POSITIVE_INFINITY,start:d,end:d,velocityYards:{x:0,y:0}}),o}function Lt(t,o,s,a){const d=Math.max(a.startTime,o),c=a.endTime;if(d>c)return null;const y=we(t),f=we(a.start),I=a.velocityYards,x={x:f.x-I.x*a.startTime,y:f.y-I.y*a.startTime},g=Qe(x,y),w=I.x*I.x+I.y*I.y-s*s,v=2*(g.x*I.x+g.y*I.y+s*s*o),B=g.x*g.x+g.y*g.y-s*s*o*o,k=[];if(Math.abs(w)<pe){if(Math.abs(v)<pe)return null;k.push(-B/v)}else{const L=v*v-4*w*B;if(L<0)return null;const W=Math.sqrt(L);k.push((-v-W)/(2*w)),k.push((-v+W)/(2*w))}let q=null;for(const L of k)L<d-pe||L>c+pe||L<o-pe||(q===null||L<q)&&(q=L);return q}function we(t){return{x:t.x*re,y:t.y*se}}function Ze(t,o,s){return t+(o-t)*s}function Qe(t,o){return{x:t.x-o.x,y:t.y-o.y}}function Ct(t,o){return{x:t.x*o,y:t.y*o}}function Dt(t,o,s){return Math.min(Math.max(t,o),s)}const Yt=1,et=6,tt=.05;function qe(t,o,s,a={}){return o.team!=="defense"?ye(o,s):o.assignment?o.assignment.type==="man"?Nt(t,o,s,a):zt(t,o,s,a):o.start}function Nt(t,o,s,a){var w;if(((w=o.assignment)==null?void 0:w.type)!=="man")return o.start;const d=o.assignment.targetId,c=t.players.find(v=>v.id===d);if(!c)return o.start;const y=a.radiusYards??Yt,f=o.assignment.speed??a.defaultSpeed??et,I=a.stepSeconds??tt;let x=o.start,g=0;for(;g<s;){const v=Math.min(I,s-g),B=ye(c,g+v);x=Rt(x,B,y,f,v),g+=v}return x}function zt(t,o,s,a){var w;if(((w=o.assignment)==null?void 0:w.type)!=="zone")return o.start;const d=o.assignment.radiusX,c=o.assignment.radiusY,y=o.assignment.speed??a.defaultSpeed??et,f=a.stepSeconds??tt,I=o.start;let x=o.start,g=0;for(;g<s;){const v=Math.min(f,s-g),B=Bt(t,g+v,I,d,c,x),k=B?ze(B,I,d,c):I;x=kt(x,k,I,d,c,y,v),g+=v}return x}function Bt(t,o,s,a,d,c){const y=t.players.filter(x=>x.team==="offense");if(y.length===0)return null;let f=null,I=Number.POSITIVE_INFINITY;for(const x of y){const g=ye(x,o),w=ze(g,s,a,d),v=He(g,w),B=He(c,w),k=v*10+B;k<I&&(I=k,f=w)}return f}function kt(t,o,s,a,d,c,y){const f=ee(t),I=ee(o),x=Ne(I,f),g=Math.hypot(x.x,x.y);if(g<1e-6)return t;const w=Math.max(0,c*y),v=Math.min(1,w/g),B={x:f.x+x.x*v,y:f.y+x.y*v};return ze(Ae(B),s,a,d)}function Rt(t,o,s,a,d){const c=ee(t),y=ee(o),f=Ne(c,y),I=Math.hypot(f.x,f.y);let x;I<1e-6?x={x:y.x+s,y:y.y}:x={x:y.x+f.x/I*s,y:y.y+f.y/I*s};const g=Ne(x,c),w=Math.hypot(g.x,g.y);if(w<1e-6)return t;const v=Math.max(0,a*d);if(w<=v)return Ae(x);const B=v/w,k={x:c.x+g.x*B,y:c.y+g.y*B};return Ae(k)}function ee(t){return{x:t.x*re,y:t.y*se}}function Ae(t){return{x:t.x/re,y:t.y/se}}function Ne(t,o){return{x:t.x-o.x,y:t.y-o.y}}function ze(t,o,s,a){const d=ee(o),c=ee(t),y=c.x-d.x,f=c.y-d.y,I=s>0?y/s:0,x=a>0?f/a:0,g=Math.hypot(I,x);if(g<=1)return t;const w=1/g,v={x:d.x+y*w,y:d.y+f*w};return Ae(v)}function He(t,o){const s=ee(t),a=ee(o);return Math.hypot(s.x-a.x,s.y-a.y)}const Ve={offense:{fill:"#f7b84b",stroke:"#3b2c1a",route:"rgba(247, 184, 75, 0.65)"},defense:{fill:"#76d1ff",stroke:"#153447",route:"rgba(118, 209, 255, 0.65)"}};function Ft(t){const o=t.getContext("2d");if(!o)throw new Error("Canvas 2D context is unavailable.");let s={x:0,y:0,width:0,height:0},a=window.devicePixelRatio||1;function d(){const{clientWidth:n,clientHeight:l}=t;a=window.devicePixelRatio||1,t.width=Math.max(1,Math.floor(n*a)),t.height=Math.max(1,Math.floor(l*a)),o.setTransform(a,0,0,a,0,0),s=c(n,l)}function c(n,l){const u=Math.max(18,Math.min(n,l)*.07);return{x:u,y:u,width:Math.max(1,n-u*2),height:Math.max(1,l-u*2)}}function y(n){const l=t.width/a,u=t.height/a;o.clearRect(0,0,l,u),f(o,s),I(o,n),x(o,n),w(o,n),v(o,n)}function f(n,l){const u=n.createLinearGradient(l.x,l.y,l.x+l.width,l.y+l.height);u.addColorStop(0,"#205a41"),u.addColorStop(1,"#123a2a"),n.save(),n.fillStyle=u,n.fillRect(l.x,l.y,l.width,l.height),n.strokeStyle="rgba(255, 255, 255, 0.15)",n.lineWidth=1.5,n.strokeRect(l.x,l.y,l.width,l.height);const p=6;for(let E=1;E<p;E+=1){const T=l.y+l.height/p*E;n.beginPath(),n.moveTo(l.x,T),n.lineTo(l.x+l.width,T),n.strokeStyle="rgba(255, 255, 255, 0.08)",n.lineWidth=1,n.stroke()}const b=l.y+l.height*.5;n.beginPath(),n.moveTo(l.x,b),n.lineTo(l.x+l.width,b),n.strokeStyle="rgba(255, 255, 255, 0.6)",n.lineWidth=2,n.setLineDash([10,8]),n.stroke(),n.setLineDash([]),n.restore()}function I(n,l){for(const u of l.play.players){if(u.team==="defense")continue;const p=u.route??[];if(p.length===0)continue;const b=Ve[u.team];let E=L(u.start);n.save(),n.strokeStyle=b.route,n.lineWidth=u.id===l.selectedPlayerId?3:2,n.setLineDash([6,6]);for(const T of p){const A=L(T.to);n.beginPath(),n.moveTo(E.x,E.y),n.lineTo(A.x,A.y),n.stroke(),E=A}n.setLineDash([]),n.fillStyle=b.route;for(const T of p){const A=L(T.to);n.beginPath(),n.arc(A.x,A.y,z(),0,Math.PI*2),n.fill()}n.restore()}}function x(n,l){var u;for(const p of l.play.players){if(p.team!=="defense"||((u=p.assignment)==null?void 0:u.type)!=="zone")continue;const b=L(p.start),E=p.assignment.radiusX/re*s.width,T=p.assignment.radiusY/se*s.height;n.save(),n.strokeStyle="rgba(118, 209, 255, 0.6)",n.lineWidth=2,n.setLineDash([8,6]),n.beginPath(),n.ellipse(b.x,b.y,E,T,0,0,Math.PI*2),n.stroke(),n.setLineDash([]),n.restore(),p.id===l.selectedPlayerId&&g(n,b,E,T)}}function g(n,l,u,p){const E=[{x:l.x+u,y:l.y},{x:l.x,y:l.y+p}];n.save(),n.fillStyle="#ffffff",n.strokeStyle="rgba(21, 52, 71, 0.9)",n.lineWidth=2;for(const T of E)n.beginPath(),n.arc(T.x,T.y,7,0,Math.PI*2),n.fill(),n.stroke();n.restore()}function w(n,l){const u=ie();for(const p of l.play.players){const b=qe(l.play,p,l.playTime),E=L(b),T=Ve[p.team];n.save(),n.beginPath(),n.fillStyle=T.fill,n.strokeStyle=T.stroke,n.lineWidth=2,n.arc(E.x,E.y,u,0,Math.PI*2),n.fill(),n.stroke(),p.id===l.selectedPlayerId&&(n.beginPath(),n.strokeStyle="rgba(255, 255, 255, 0.9)",n.lineWidth=2,n.arc(E.x,E.y,u+6,0,Math.PI*2),n.stroke()),n.fillStyle="#0f1411",n.font=`${Math.max(10,u)}px "Space Mono", monospace`,n.textAlign="center",n.textBaseline="middle",n.fillText(p.label,E.x,E.y+1),n.restore()}}function v(n,l){const u=l.ball;if(!u.position)return;const p=L(u.position),b=Math.max(5,Math.min(s.width,s.height)*.012);u.inAir&&u.flight&&(B(n,u.flight),k(n,p,u.flight));const E=u.flight?Math.atan2(u.flight.end.y-u.flight.start.y,u.flight.end.x-u.flight.start.x):0;q(n,p,b,E)}function B(n,l){const u=L(l.start),p=L(l.end),b=p.x-u.x,E=p.y-u.y,T=Math.hypot(b,E);if(T<=.1)return;const A=-E/T,G=b/T,h=Math.min(48,T*.3),R=(u.x+p.x)/2+A*h,J=(u.y+p.y)/2+G*h;n.save(),n.strokeStyle="rgba(255, 255, 255, 0.35)",n.lineWidth=2,n.setLineDash([6,8]),n.beginPath(),n.moveTo(u.x,u.y),n.quadraticCurveTo(R,J,p.x,p.y),n.stroke(),n.restore()}function k(n,l,u){const p=L(u.start),b=L(u.end),E=b.x-p.x,T=b.y-p.y,A=Math.hypot(E,T);if(A<=.1)return;const G=E/A,h=T/A;n.save(),n.strokeStyle="rgba(255, 255, 255, 0.65)",n.lineWidth=2,n.beginPath(),n.moveTo(l.x-G*12,l.y-h*12),n.lineTo(l.x,l.y),n.stroke(),n.restore()}function q(n,l,u,p){n.save(),n.translate(l.x,l.y),n.rotate(p),n.scale(1.6,1),n.fillStyle="#9c5a2a",n.strokeStyle="#4f2b14",n.lineWidth=1.5,n.beginPath(),n.ellipse(0,0,u,u*.7,0,0,Math.PI*2),n.fill(),n.stroke(),n.strokeStyle="rgba(255, 255, 255, 0.85)",n.lineWidth=1.5,n.beginPath(),n.moveTo(-u*.6,0),n.lineTo(u*.6,0),n.stroke(),n.restore()}function L(n){return{x:s.x+n.x*s.width,y:s.y+n.y*s.height}}function W(n){return n.x<s.x||n.x>s.x+s.width||n.y<s.y||n.y>s.y+s.height?null:{x:(n.x-s.x)/s.width,y:(n.y-s.y)/s.height}}function ie(){return Math.max(12,Math.min(s.width,s.height)*.03)}function z(){return Math.max(6,Math.min(s.width,s.height)*.015)}function ae(n,l,u){const p=ie();for(let b=l.players.length-1;b>=0;b-=1){const E=l.players[b],T=qe(l,E,u),A=L(T);if(Math.hypot(n.x-A.x,n.y-A.y)<=p+4)return E.id}return null}function H(n,l,u){if(!l)return null;const p=u.players.find(T=>T.id===l);if(!p)return null;const b=p.route??[];if(b.length===0)return null;const E=z();for(let T=b.length-1;T>=0;T-=1){const A=L(b[T].to);if(Math.hypot(n.x-A.x,n.y-A.y)<=E+6)return T}return null}function ve(n,l,u){var R;if(!u)return null;const p=l.players.find(J=>J.id===u);if(!p||p.team!=="defense"||((R=p.assignment)==null?void 0:R.type)!=="zone")return null;const b=L(p.start),E=p.assignment.radiusX/re*s.width,T=p.assignment.radiusY/se*s.height,A=10,G={x:b.x+E,y:b.y},h={x:b.x,y:b.y+T};return Math.hypot(n.x-G.x,n.y-G.y)<=A?"x":Math.hypot(n.x-h.x,n.y-h.y)<=A?"y":null}return{resize:d,render:y,canvasToWorld:W,hitTest:ae,hitTestWaypoint:H,hitTestZoneHandle:ve,getFieldBounds:()=>s}}const Be="playmaker.play.v1";function Ot(){try{const t=localStorage.getItem(Be);return t?Ge(t):null}catch{return null}}function _t(t){try{localStorage.setItem(Be,Te(t))}catch{}}function $t(){try{localStorage.removeItem(Be)}catch{}}const Wt=6,U=6,ue=10,fe=5,Ke=1;function Xt(){const t=document.getElementById("field-canvas"),o=document.getElementById("status-text"),s=document.getElementById("scrubber"),a=document.getElementById("play-toggle"),d=document.getElementById("speed-input"),c=document.getElementById("delete-player"),y=document.getElementById("deselect-player"),f=document.getElementById("clear-play"),I=document.getElementById("undo-action"),x=document.getElementById("redo-action"),g=document.getElementById("player-card"),w=document.querySelector(".waypoint-section"),v=document.getElementById("waypoint-list"),B=document.getElementById("time-readout"),k=document.getElementById("ball-status"),q=document.querySelector(".route-speed"),L=document.querySelector(".player-name"),W=document.getElementById("player-name-input"),ie=document.querySelector(".start-action"),z=document.getElementById("start-action-select"),ae=document.getElementById("coverage-panel"),H=document.getElementById("coverage-type-select"),ve=document.querySelector(".coverage-man"),n=document.querySelector(".coverage-zone"),l=document.getElementById("coverage-target-select"),u=document.getElementById("coverage-speed-input"),p=document.getElementById("zone-radius-x-input"),b=document.getElementById("zone-radius-y-input"),E=document.getElementById("zone-speed-input"),T=Array.from(document.querySelectorAll("[data-team]"));if(!t||!o||!s||!a||!d||!c||!y||!f||!I||!x||!g||!w||!v||!B||!k||!q||!L||!W||!ie||!z||!ae||!H||!ve||!n||!l||!u||!p||!b||!E)throw new Error("Missing required UI elements.");const A=Ft(t);let h=Ot()??Xe(),R=null,J="offense",F=0,ge=!1,he=0,V=null,O=null,le=[],de=[];new ResizeObserver(()=>{A.resize(),_()}).observe(t),A.resize();function ce(e){o.textContent=e}function C(){return R?h.players.find(e=>e.id===R)??null:null}function Le(){R&&!h.players.some(e=>e.id===R)&&(R=null)}function Se(e){R=e,j(),_()}function j(){const e=C();if(!e){g.textContent="Select a player",g.classList.add("empty"),c.disabled=!0,y.disabled=!0,v.replaceChildren();const r=document.createElement("div");r.className="waypoint-empty",r.textContent="No player selected.",v.append(r),X(w,!1),X(q,!1),d.disabled=!1,X(L,!0),W.disabled=!0,z.replaceChildren(),z.disabled=!0,X(ie,!0),X(ae,!0);return}e.team==="defense"&&nt(e),g.classList.remove("empty"),g.innerHTML=`<strong>${e.label}</strong> · ${e.team}`,c.disabled=!1,y.disabled=!1,X(q,e.team==="defense"),d.disabled=e.team==="defense",X(L,e.team==="defense"),W.disabled=e.team==="defense",e.team==="offense"?W.value=e.label:W.value="",X(ie,e.team!=="offense"),X(w,e.team==="defense"),e.team==="offense"?(ot(e),rt(e)):(z.replaceChildren(),z.disabled=!0,v.replaceChildren()),st(e)}function X(e,r){e.classList.toggle("is-hidden",r)}function nt(e){var i;if(e.team!=="defense"||e.assignment){if(e.team!=="defense")return;if(((i=e.assignment)==null?void 0:i.type)==="man"){const m=h.players.filter(M=>M.team==="offense");m.some(M=>{var N;return M.id===((N=e.assignment)==null?void 0:N.targetId)})||(m.length>0?e.assignment.targetId=m[0].id:e.assignment={type:"zone",radiusX:ue,radiusY:fe,speed:U},te())}return}const r=h.players.filter(m=>m.team==="offense");r.length>0?e.assignment={type:"man",targetId:r[0].id,speed:U}:e.assignment={type:"zone",radiusX:ue,radiusY:fe,speed:U},te()}function ot(e){if(e.team!=="offense"){z.replaceChildren(),z.disabled=!0;return}z.replaceChildren();const r=h.players.filter(m=>m.team==="offense"&&m.id!==e.id);if(r.length===0){const m=document.createElement("option");m.value="",m.textContent="Add an offensive player to pass/hand off to",m.disabled=!0,m.selected=!0,z.append(m),z.disabled=!0;return}const i=document.createElement("option");i.value="",i.textContent="None",z.append(i);for(const m of r){const S=document.createElement("option");S.value=`handoff:${m.id}`,S.textContent=`Handoff → ${m.label}`,z.append(S);const M=document.createElement("option");M.value=`pass:${m.id}`,M.textContent=`Pass → ${m.label}`,z.append(M)}e.startAction&&r.some(m=>{var S;return m.id===((S=e.startAction)==null?void 0:S.targetId)})?z.value=`${e.startAction.type}:${e.startAction.targetId}`:z.value="",z.disabled=!1}function st(e){var N,Y,Z,Q;if(e.team!=="defense"){X(ae,!0);return}X(ae,!1),H.replaceChildren();const r=document.createElement("option");r.value="man",r.textContent="Man",H.append(r);const i=document.createElement("option");i.value="zone",i.textContent="Zone",H.append(i);const m=h.players.some(P=>P.team==="offense");m||(r.disabled=!0);let S=((N=e.assignment)==null?void 0:N.type)??(m?"man":"zone");S==="man"&&!m&&(S="zone"),H.value=S,X(ve,S!=="man"),X(n,S!=="zone"),l.replaceChildren();const M=h.players.filter(P=>P.team==="offense");if(M.length===0){const P=document.createElement("option");P.value="",P.textContent="Add an offensive player to cover",P.disabled=!0,P.selected=!0,l.append(P),l.disabled=!0,u.disabled=!0,u.value=U.toString()}else{for(const P of M){const D=document.createElement("option");D.value=P.id,D.textContent=`Cover ${P.label}`,l.append(D)}((Y=e.assignment)==null?void 0:Y.type)==="man"&&M.some(P=>{var D;return P.id===((D=e.assignment)==null?void 0:D.targetId)})?(l.value=e.assignment.targetId,u.value=e.assignment.speed.toString(),u.disabled=!1):(l.value=((Z=M[0])==null?void 0:Z.id)??"",u.value=U.toString(),u.disabled=!1),l.disabled=S!=="man"}((Q=e.assignment)==null?void 0:Q.type)==="zone"?(p.value=e.assignment.radiusX.toString(),b.value=e.assignment.radiusY.toString(),E.value=e.assignment.speed.toString()):(p.value=ue.toString(),b.value=fe.toString(),E.value=U.toString()),p.disabled=S!=="zone",b.disabled=S!=="zone",E.disabled=S!=="zone"}function rt(e){v.replaceChildren();const r=e.route??[];if(r.length===0){const i=document.createElement("div");i.className="waypoint-empty",i.textContent="No waypoints yet.",v.append(i);return}r.forEach((i,m)=>{const S=document.createElement("div");S.className="waypoint-row";const M=document.createElement("div");M.className="waypoint-label",M.textContent=`Leg ${m+1}`;const N=document.createElement("input");N.type="number",N.min="0.1",N.step="0.1",N.value=i.speed.toString(),N.className="waypoint-speed",N.addEventListener("change",()=>{const P=ne(N.value,i.speed);P!==i.speed&&$(()=>{const D=C();D!=null&&D.route&&(D.route[m].speed=P)})});const Y=document.createElement("select");Y.className="waypoint-action";const Z=h.players.filter(P=>P.team==="offense"&&P.id!==e.id);if(Z.length===0){const P=document.createElement("option");P.value="",P.textContent="Add an offensive player to pass/hand off to",P.disabled=!0,P.selected=!0,Y.append(P),Y.disabled=!0}else{const P=document.createElement("option");P.value="",P.textContent="Action: none",Y.append(P);for(const D of Z){const K=document.createElement("option");K.value=`handoff:${D.id}`,K.textContent=`Handoff → ${D.label}`,Y.append(K);const Ee=document.createElement("option");Ee.value=`pass:${D.id}`,Ee.textContent=`Pass → ${D.label}`,Y.append(Ee)}i.action&&Z.some(D=>{var K;return D.id===((K=i.action)==null?void 0:K.targetId)})?Y.value=`${i.action.type}:${i.action.targetId}`:Y.value="",Y.disabled=!1}Y.addEventListener("change",()=>{if(Y.disabled)return;const P=Y.value;$(()=>{const D=C();if(!(D!=null&&D.route))return;if(!P){D.route[m].action=void 0;return}const[K,Ee]=P.split(":");K!=="pass"&&K!=="handoff"||(D.route[m].action={type:K,targetId:Ee})})});const Q=document.createElement("button");Q.type="button",Q.className="tertiary",Q.textContent="Remove",Q.addEventListener("click",()=>{$(()=>{const P=C();P!=null&&P.route&&P.route.splice(m,1)})}),S.append(M,N,Y,Q),v.append(S)})}function Ce(){const e=Ye(h);s.max=e.toString(),F=Math.min(F,e),s.value=F.toString(),B.textContent=`${F.toFixed(1)}s / ${e.toFixed(1)}s`,a.disabled=e<=0}function it(){const e=h.players.find(r=>r.team==="offense")??null;k.textContent=e?`Ball starts with ${e.label}.`:"No ball carrier yet."}function _(){const e=Tt(h,F,Pt);A.render({play:h,playTime:F,selectedPlayerId:R,ball:e}),Ce(),it()}function te(){_t(h)}function De(e){le.push(e),de=[],be()}function be(){I.disabled=le.length===0,x.disabled=de.length===0}function $(e){const r=Te(h),i=Ie(h);e(),Le(),j(),_(),Te(h)!==r&&(De(i),te())}function ke(e){J=e;for(const r of T)r.classList.toggle("active",r.dataset.team===e);if(e==="defense"){const r=C();(r==null?void 0:r.team)==="offense"&&Se(null)}}function Re(e){F=Math.max(0,e),Ce(),_()}function xe(){ge=!1,a.textContent="Play"}function at(){const e=Ye(h);e<=0||(F>=e&&(F=0),ge=!0,he=0,a.textContent="Pause",requestAnimationFrame(Fe))}function Fe(e){if(!ge)return;he||(he=e);const r=(e-he)/1e3;he=e;const i=Ye(h);F=Math.min(F+r,i),F>=i&&xe(),_(),ge&&requestAnimationFrame(Fe)}function lt(e){const r=Ut(J,h.players),i={id:Zt(),label:r,team:J,start:e,route:[]};if(J==="defense"){const m=h.players.filter(S=>S.team==="offense");m.length>0?i.assignment={type:"man",targetId:m[0].id,speed:U}:i.assignment={type:"zone",radiusX:ue,radiusY:fe,speed:U}}h.players.push(i),ce(`Added ${r}.`)}function dt(e,r){const i=ne(d.value,Wt),m=e.route??[],S={to:r,speed:i};m.push(S),e.route=m,ce(`Added waypoint for ${e.label}.`)}function ct(e,r){const i=C();i&&(V={playerId:i.id,waypointIndex:r,pointerId:e,snapshot:Ie(h),moved:!1},t.setPointerCapture(e))}function ut(e){if(!V||V.pointerId!==e.pointerId)return;const r=C();if(!(r!=null&&r.route))return;const i=t.getBoundingClientRect(),m={x:e.clientX-i.left,y:e.clientY-i.top},S=A.canvasToWorld(m);if(!S)return;const M=r.route[V.waypointIndex];M&&(M.to=S,V.moved=!0,_())}function Oe(e){!V||V.pointerId!==e.pointerId||(t.releasePointerCapture(e.pointerId),V.moved&&(De(V.snapshot),te(),j()),V=null,_())}function ft(e,r){var m;const i=C();!i||((m=i.assignment)==null?void 0:m.type)!=="zone"||(O={playerId:i.id,axis:r,pointerId:e,snapshot:Ie(h),moved:!1},t.setPointerCapture(e))}function pt(e){var Y;if(!O||O.pointerId!==e.pointerId)return;const r=h.players.find(Z=>Z.id===O.playerId);if(!r||((Y=r.assignment)==null?void 0:Y.type)!=="zone")return;const i=t.getBoundingClientRect(),m={x:e.clientX-i.left,y:e.clientY-i.top},S=A.canvasToWorld(m);if(!S)return;const M=Math.abs(S.x-r.start.x)*re,N=Math.abs(S.y-r.start.y)*se;O.axis==="x"?(r.assignment.radiusX=Math.max(Ke,M),p.value=r.assignment.radiusX.toFixed(1)):(r.assignment.radiusY=Math.max(Ke,N),b.value=r.assignment.radiusY.toFixed(1)),O.moved=!0,_()}function _e(e){!O||O.pointerId!==e.pointerId||(t.releasePointerCapture(e.pointerId),O.moved&&(De(O.snapshot),te(),j()),O=null,_())}function $e(){le.length!==0&&(de.push(Ie(h)),h=le.pop()??h,Le(),te(),j(),_(),be())}function We(){de.length!==0&&(le.push(Ie(h)),h=de.pop()??h,Le(),te(),j(),_(),be())}t.addEventListener("pointerdown",e=>{if(e.button!==0)return;xe();const r=t.getBoundingClientRect(),i={x:e.clientX-r.left,y:e.clientY-r.top},m=A.hitTestZoneHandle(i,h,R);if(m){ft(e.pointerId,m);return}const S=C();if((S==null?void 0:S.team)==="offense"){const Z=A.hitTestWaypoint(i,R,h);if(Z!==null){ct(e.pointerId,Z);return}}const M=A.hitTest(i,h,F);if(M){if(M===R){Se(null),ce("Add player mode.");return}Se(M),ce("Player selected. Tap to add waypoints.");return}const N=A.canvasToWorld(i);if(!N)return;Re(0);const Y=C();if(Y&&Y.team==="offense"){$(()=>{dt(Y,N)});return}$(()=>{lt(N)})}),t.addEventListener("pointermove",e=>{if(O){pt(e);return}ut(e)}),t.addEventListener("pointerup",e=>{if(O){_e(e);return}Oe(e)}),t.addEventListener("pointercancel",e=>{if(O){_e(e);return}Oe(e)}),s.addEventListener("input",()=>{xe();const e=Number(s.value);Number.isFinite(e)&&Re(e)}),a.addEventListener("click",()=>{if(ge){xe(),_();return}at()}),c.addEventListener("click",()=>{const e=C();e&&$(()=>{h.players=h.players.filter(r=>r.id!==e.id),R=null,ce("Player removed.")})}),y.addEventListener("click",()=>{Se(null)}),z.addEventListener("change",()=>{const e=z.value;$(()=>{const r=C();if(!r)return;if(!e){r.startAction=void 0;return}const[i,m]=e.split(":");i!=="pass"&&i!=="handoff"||(r.startAction={type:i,targetId:m})})}),H.addEventListener("change",()=>{const e=H.value;$(()=>{var i;const r=C();if(r){if(e==="man"){const S=(i=h.players.filter(N=>N.team==="offense")[0])==null?void 0:i.id;if(!S){r.assignment={type:"zone",radiusX:ue,radiusY:fe,speed:U};return}const M=ne(u.value,U);r.assignment={type:"man",targetId:S,speed:M};return}e==="zone"&&(r.assignment={type:"zone",radiusX:Pe(p.value,ue),radiusY:Pe(b.value,fe),speed:ne(E.value,U)})}})}),l.addEventListener("change",()=>{if(H.value!=="man")return;const e=l.value;$(()=>{const r=C();if(!r||!e)return;const i=ne(u.value,U);r.assignment={type:"man",targetId:e,speed:i}})}),u.addEventListener("change",()=>{const e=C();if(!(e!=null&&e.assignment)||e.assignment.type!=="man")return;const r=ne(u.value,e.assignment.speed);r!==e.assignment.speed&&$(()=>{const i=C();i!=null&&i.assignment&&i.assignment.type==="man"&&(i.assignment.speed=r)})}),p.addEventListener("change",()=>{const e=C();if(!(e!=null&&e.assignment)||e.assignment.type!=="zone")return;const r=Pe(p.value,e.assignment.radiusX);r!==e.assignment.radiusX&&$(()=>{const i=C();!(i!=null&&i.assignment)||i.assignment.type!=="zone"||(i.assignment.radiusX=r)})}),b.addEventListener("change",()=>{const e=C();if(!(e!=null&&e.assignment)||e.assignment.type!=="zone")return;const r=Pe(b.value,e.assignment.radiusY);r!==e.assignment.radiusY&&$(()=>{const i=C();!(i!=null&&i.assignment)||i.assignment.type!=="zone"||(i.assignment.radiusY=r)})}),E.addEventListener("change",()=>{const e=C();if(!(e!=null&&e.assignment)||e.assignment.type!=="zone")return;const r=ne(E.value,e.assignment.speed);r!==e.assignment.speed&&$(()=>{const i=C();!(i!=null&&i.assignment)||i.assignment.type!=="zone"||(i.assignment.speed=r)})}),W.addEventListener("change",()=>{const e=C();if(!e||e.team!=="offense")return;const r=W.value.trim();if(!r){W.value=e.label;return}r!==e.label&&$(()=>{const i=C();!i||i.team!=="offense"||(i.label=r)})}),f.addEventListener("click",()=>{confirm("Clear the current play?")&&(h=Xe(),R=null,F=0,le=[],de=[],$t(),be(),ce("Play cleared."),j(),_())}),I.addEventListener("click",$e),x.addEventListener("click",We),window.addEventListener("keydown",e=>{const r=e.target;r&&(r.tagName==="INPUT"||r.tagName==="TEXTAREA")||!((navigator.platform?navigator.platform.toLowerCase():"").includes("mac")?e.metaKey:e.ctrlKey)||(e.key.toLowerCase()==="z"&&!e.shiftKey&&(e.preventDefault(),$e()),(e.key.toLowerCase()==="z"&&e.shiftKey||e.key.toLowerCase()==="y")&&(e.preventDefault(),We()))});for(const e of T)e.addEventListener("click",()=>{const r=e.dataset.team;r&&ke(r)});ke(J),be(),j(),Ce(),_()}function Ut(t,o){const s=t==="offense"?"O":"D",a=o.filter(d=>d.team===t).length+1;return`${s}${a}`}function ne(t,o){const s=Number(t);return!Number.isFinite(s)||s<=0?o:s}function Pe(t,o){const s=Number(t);return!Number.isFinite(s)||s<=0?o:s}function Zt(){return typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`player-${Math.random().toString(16).slice(2)}-${Date.now().toString(16)}`}function Ie(t){const o=Ge(Te(t));if(!o)throw new Error("Unable to clone play state.");return o}Xt();
